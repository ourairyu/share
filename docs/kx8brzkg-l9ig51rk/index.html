<!DOCTYPE html> <html lang="zh-CN" dir="ltr"> <head> <meta charset="UTF-8"> <!-- SEO --> <title>机器人工厂问答库配置化改造</title> <meta property="og:title" content="机器人工厂问答库配置化改造"> <meta name="description" content="项目安排"> <meta property="og:description" content="项目安排"> <link rel="canonical" href="https://ourai.ws/docs/kx8brzkg-l9ig51rk/"> <meta property="og:url" content="https://ourai.ws/docs/kx8brzkg-l9ig51rk/"> <meta property="og:site_name" content="欧雷共享的内容"> <script type="application/ld+json"> { "@context" : "http://schema.org", "@type" : "WebSite", "name" : "欧雷共享的内容", "url" : "https://ourai.ws" } </script> <meta property="og:type" content="article"> <meta property="article:published_time" content="2021-12-16T10:10:10+08:00"> <link rel="prev" href="https://ourai.ws/docs/kruel7yw-l86n1pun/" title="配置驱动中后台前端应用开发框架"> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "NewsArticle", "headline": "机器人工厂问答库配置化改造", "image": null, "datePublished": "2021-12-16T10:10:10+08:00", "description": "项目安排" } </script> <link rel="author" href="https://ourai.ws"> <!-- 页面渲染兼容性 --> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="renderer" content="webkit"> <meta name="viewport" content="width=device-width,initial-scale=1.0"> <!-- 订阅 --> <link type="application/atom+xml" rel="alternate" href="https://ourai.ws/atom.xml" title="欧雷流" /> <meta name="theme-color" content="#0871ab"> <link type="application/rss+xml" rel="alternate" href="//share.ourai.ws/rss.xml" title="欧雷共享的内容"> <!-- 站点 icon --> <link rel="icon" href="/assets/favicon-3e749ca030e3b71eb2662d947c789061d2da9e0f4ee5f3360cfa9ccbe053c8ba.ico"> <!-- 静态资源 --> <link type="text/css" rel="stylesheet" href="/assets/disqusjs.min-b077139304675330d06888b873bd88158951637593a3c17c4674bc855caf71af.css"> <link type="text/css" rel="stylesheet" href="/assets/global-cf407110a040e90d8729159566aed4aaf5b58023447f098d688501887e91f510.css"> <link type="text/css" rel="stylesheet" href="/assets/pages/post-d5f1244d69bfc31e3c7b73b16140ed8a09f0b5af40515abeae522bee80e92ec9.css"><link type="text/css" rel="stylesheet" href="/assets/pages/doc-15661195aff8193ee3a0adaa519b494768847c03556ce215fa6c17d46d273872.css"> <script type="text/javascript" src="/assets/global-b3a80dd53acf48ad7228d6fd741dba15d3845cbc3783bdbbf7244151a45628aa.js"></script> <!--[if lt IE 9]> <script type="text/javascript" src="/assets/support_ie8-e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.js"></script> <![endif]--> </head> <body class="Page" itemscope itemtype="http://schema.org/WebPage"> <main class="Page-content"> <div id="sharedDoc" class="container"> <p style="height: 100%; display: flex; align-items: center; justify-content: center; font-size: 8rem;">🙅🏻‍♂️</p> </div> </main> <ourai-doc id="__ourai_doc__" style="display: none;" data-code="1cs3"> <article class="Page-main Article"> <header class="Article-header"> <h1 class="Article-title">机器人工厂问答库配置化改造</h1> <p><a href="https://ourai.ws/people/ourai/" target="_blank" ref="external nofollow">欧雷</a> 发表于 <time datetime="2021-12-16T10:10:10+08:00">2021-12-16 10:10:10</time></p> </header> <div class="Article-content col-md-9"><h2 id="section">项目安排</h2> <table> <thead> <tr> <th>项目</th> <th>内容</th> </tr> </thead> <tbody> <tr> <td>时间</td> <td>2021 年 12 月 16 日</td> </tr> <tr> <td>优先级</td> <td>低</td> </tr> <tr> <td>人员</td> <td>前端：<a href="https://yaol.in/" title="查看林垚的个人主页" target="_blank" rel="external nofollow">林垚</a></td> </tr> </tbody> </table> <h2 id="section-1">需求分析</h2> <h3 id="section-2">表单/详情页</h3> <p>表单页与详情页是在一个文件里实现的，并且问题与答案杂糅在一起，实际上可以认为这个页面就是答案的表单页与详情页：</p> <p><img src="/assets/docs/kx8brzkg-l9ig51rk/detail-and-form-of-question-and-answer-234d780a6daeca6c79b97cbab61d620e27d6928a4532e7b453c502b170498e3e.png" alt="" /></p> <h2 id="section-3">设计</h2> <h3 id="section-4">列表页</h3> <h3 id="section-5">表单/详情页</h3> <h4 id="section-6">类型定义</h4> <figure class="highlight"><pre><code class="language-ts" data-lang="ts"><span></span><span class="kd">interface</span> <span class="nx">Dimension</span> <span class="p">{}</span>

<span class="kd">interface</span> <span class="nx">CommandParam</span> <span class="p">{}</span>

<span class="kd">interface</span> <span class="nx">Command</span> <span class="p">{</span>
  <span class="nx">code</span>: <span class="kt">string</span><span class="p">;</span>
  <span class="nx">label</span>: <span class="kt">string</span><span class="p">;</span>
  <span class="nx">params</span>: <span class="kt">CommandParam</span><span class="p">[];</span>
<span class="p">}</span>

<span class="kd">interface</span> <span class="nx">Answer</span> <span class="p">{</span>
  <span class="nx">content</span>: <span class="kt">string</span><span class="p">;</span>
  <span class="nx">remark</span>: <span class="kt">string</span><span class="p">;</span>
  <span class="nx">dimensions</span>: <span class="kt">Dimension</span><span class="p">[];</span>
  <span class="nx">commands</span>: <span class="kt">Command</span><span class="p">[];</span>
  <span class="nx">approval</span><span class="o">:</span> <span class="s1">&#39;pending&#39;</span> <span class="o">|</span> <span class="s1">&#39;passed&#39;</span> <span class="o">|</span> <span class="s1">&#39;not-passed&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">interface</span> <span class="nx">Question</span> <span class="p">{</span>
  <span class="nx">title</span>: <span class="kt">string</span><span class="p">;</span>
  <span class="nx">category</span>: <span class="kt">string</span><span class="p">;</span>
  <span class="nx">tags</span>: <span class="kt">string</span><span class="p">[];</span>
  <span class="nx">recommendationEnabled</span>: <span class="kt">boolean</span><span class="p">;</span>
  <span class="nx">searchEnabled</span>: <span class="kt">boolean</span><span class="p">;</span>
  <span class="nx">matchAllEnabled</span>: <span class="kt">boolean</span><span class="p">;</span>
  <span class="nx">answers</span>: <span class="kt">Answer</span><span class="p">[];</span>
<span class="p">}</span></code></pre></figure> <h4 id="section-7">数据服务</h4> <p>涉及到的 HTTP API 有：</p> <figure class="highlight"><pre><code class="language-ts" data-lang="ts"><span></span><span class="c1">// 获取问题详情</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">getKnowledgeDetailById</span><span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">httpClient</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="sb">`/api/standardQuestion/</span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 新增问题</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">insertQuestion</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">httpClient</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&quot;/api/knowledge/v2/add&quot;</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 更新问题</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">updateQuestion</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">httpClient</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&quot;/api/standardQuestion/merge&quot;</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 删除问题</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">removeQuestion</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">httpClient</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&quot;/api/standardQuestion/delete&quot;</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 保存编辑后的标签</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">updateTagList</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">httpClient</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="sb">`/api/standardQuestion/updateTags/</span><span class="si">${</span><span class="nx">options</span><span class="p">.</span><span class="nx">standardId</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">list</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 更新「全匹配开关」、「推荐服务开关」和「搜索服务开关」的状态</span>
<span class="c1">// 在 `question-and-answer` 模块中已经定义</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">updateQuestionEnableMatch</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">httpClient</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&quot;/api/standardQuestion/update/enable/match&quot;</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 获取答案列表</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">getAnswerListByQuestionId</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">httpClient</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;/api/answer/get&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">params</span>: <span class="kt">options</span> <span class="p">});</span>
<span class="p">}</span>

<span class="c1">// 获取答案列表</span>
<span class="c1">// 应该是废弃了，没有调用的地方，但后端没标记为被废弃</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">getAnswerListByStandardIdV2</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">httpClient</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;/api/answer/get/v2&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">params</span>: <span class="kt">options</span> <span class="p">});</span>
<span class="p">}</span>

<span class="c1">// 新增答案</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">insertAnswer</span><span class="p">(</span><span class="nx">options</span>: <span class="kt">any</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">httpClient</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&quot;/api/answer/add&quot;</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 更新答案</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">updateAnswer</span><span class="p">(</span><span class="nx">options</span>: <span class="kt">any</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">httpClient</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&quot;/api/answer/update&quot;</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 删除答案</span>
<span class="c1">// 在 `question-and-answer` 模块中已经定义</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">removeAnswer</span><span class="p">({</span> <span class="nx">answerId</span> <span class="p">})</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">httpClient</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;/api/answer/delete&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">params</span><span class="o">:</span> <span class="p">{</span> <span class="nx">answerId</span> <span class="p">}</span> <span class="p">});</span>
<span class="p">}</span></code></pre></figure> <h4 id="section-8">界面交互</h4> <p>说明问题与答案相关的交互及状态变更。</p> <h5 id="section-9">问题本身</h5> <p>问题本身显示的字段及在新增问题时的默认状态：</p> <table> <thead> <tr> <th>字段</th> <th>必填</th> <th>默认状态</th> </tr> </thead> <tbody> <tr> <td>标题</td> <td>是</td> <td>-</td> </tr> <tr> <td>目录</td> <td>是</td> <td>选中「业务知识」</td> </tr> <tr> <td>标签</td> <td>否</td> <td>-</td> </tr> <tr> <td>全匹配开关</td> <td>否</td> <td>开启</td> </tr> <tr> <td>推荐服务开关</td> <td>否</td> <td>开启</td> </tr> <tr> <td>搜索服务开关</td> <td>否</td> <td>开启</td> </tr> <tr> <td>答案列表</td> <td>否</td> <td>有一条未保存的空答案</td> </tr> </tbody> </table> <p>在查看详情与编辑时，开关类字段可以在切换状态时直接持久化。</p> <p>相关操作有：</p> <table> <thead> <tr> <th>操作</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>返回</td> <td>返回到上一页而非返回到列表页</td> </tr> <tr> <td>编辑</td> <td>弹出问题编辑对话框</td> </tr> <tr> <td>删除</td> <td>删除成功后返回到问题列表</td> </tr> <tr> <td>取消</td> <td>同「返回」，仅在新增问题时可见</td> </tr> <tr> <td>保存</td> <td>保存成功后替换跳转到问题详情页，仅在新增问题时可见</td> </tr> <tr> <td>编辑标签</td> <td>弹出标签操作对话框</td> </tr> </tbody> </table> <h5 id="section-10">答案列表</h5> <p>根据 URL 传参决定默认选中哪个答案，并根据情况设为编辑状态。</p> <p>相关操作有：</p> <table> <thead> <tr> <th>操作</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>新增</td> <td>有未保存答案时不能新增空答案并进行提示</td> </tr> <tr> <td>查看</td> <td>缓存处于编辑状态的答案的数据并以只读状态查看指定答案</td> </tr> <tr> <td>编辑</td> <td>有处于编辑状态的答案时不能编辑指定答案并进行提示</td> </tr> <tr> <td>删除</td> <td>删除的是仅剩的一条答案时会同时删除问题并在删除成功后返回到问题列表；删除当前选中的答案成功后选中剩余答案中的第一条</td> </tr> </tbody> </table> <h5 id="section-11">答案本身</h5> <p>答案本身显示的字段及在新增答案时的默认状态：</p> <table> <thead> <tr> <th>字段</th> <th>必填</th> <th>默认状态</th> </tr> </thead> <tbody> <tr> <td>答案正文</td> <td>是</td> <td>-</td> </tr> <tr> <td>内部提示</td> <td>受开关控制</td> <td>显示开关为「关闭」状态，设为「开启」时内容必填</td> </tr> <tr> <td>维度</td> <td>否</td> <td>-</td> </tr> <tr> <td>指令</td> <td>否</td> <td>-</td> </tr> <tr> <td>审核状态</td> <td>否</td> <td>仅在查看答案详情和编辑答案时显示</td> </tr> </tbody> </table> <p>相关操作有：</p> <table> <thead> <tr> <th>操作</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>取消</td> <td>选中答案进入只读状态</td> </tr> <tr> <td>保存</td> <td>选中答案数据持久化后进入只读状态</td> </tr> </tbody> </table> <h4 id="section-12">数据交互</h4> <p>整体逻辑是从 URL 中拿到必要参数后向后端请求问题详情数据，初始化问题本身的信息展示。</p> <p>在答案列表字段部件创建后获取通用的维度和指令相关数据，并根据问题 ID 获取答案列表数据，再将这些数据根据展示需要进行整合。</p> <h4 id="section-13">文件拆分</h4> <p>将 <code>knowledge</code> 模块 <code>views/knowledge-detail</code> 文件夹内的文件在 <code>question-and-answer</code> 模块下拆分为以下几个视图（日后根据情况再考虑将答案相关的拆分到 <code>answer</code> 模块）：</p> <figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>src/domain
   └── question-and-answer
       ├── views
       │   ├── answer-detail
       │   │   ├── AnswerDetail.vue
       │   │   └── index.ts
       │   ├── answer-form
       │   │   ├── AnswerForm.vue
       │   │   └── index.ts
       │   ├── question-and-answer-data-detail
       │   │   ├── EditTagAction.vue
       │   │   ├── EditLogField.vue
       │   │   ├── QuestionAndAnswerDataDetail.vue
       │   │   └── index.ts
       │   ├── question-and-answer-data-form
       │   │   ├── QuestionAndAnswerDataForm.vue
       │   │   └── index.ts
       │   └── question-form
       │       └── index.ts
       └── widgets
           ├── answer-list-field
           │   ├── AnswerListField.vue
           │   └── index.ts
           ├── command-list-field
           │   ├── CommandListField.vue
           │   └── index.ts
           └── service-switch-field
               ├── ServiceSwitchField.vue
               └── index.ts</code></pre></figure> <p>并把答案指令相关的转移到 <code>command</code> 模块：</p> <figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>src/domain
   └── command
       └── views
           ├── command-data-form
           │   ├── CommandParamListField.vue
           │   └── index.ts
           └── command-data-list
               └── index.ts</code></pre></figure> </div> <footer class="Article-footer col-md-3"><section class="Widget Widget--toc"> <div class="Widget-header"> <h2 class="Widget-title">目录</h2> </div> <div class="Widget-body"></div> </section> </footer> </article> </ourai-doc> <script type="text/javascript" src="/assets/pages/doc-c880dc4660dee6b589b91fa90d96d4362f806002998d7fba77f76c8db76c973d.js"></script><script type="text/javascript" src="/assets/components-a266f21fe1dfd61bebf40e74872cbf901eb3e201f7d33e9e5d5af9a55f4b24ea.js"></script> <script type="text/javascript" src="/assets/initializers/time-8d7a529a66ae6cb53c2283d21fd6a12c538b8473dd5bd76458366d09adce7bf6.js"></script><script type="text/javascript" src="/assets/initializers/lazyload-44b7df8a9282d598284d522e64d6be9ac88d466f3c4a734a514303e99347b2c9.js"></script> </body> </html>
