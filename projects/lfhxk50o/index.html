<!DOCTYPE html> <html lang="zh-CN" dir="ltr"> <head> <meta charset="UTF-8"> <!-- SEO --> <title>网站主题 Lime 抽取并开源</title> <meta property="og:title" content="网站主题 Lime 抽取并开源"> <meta name="description" content="起初只有一个做内容分享的网站时，不存在主题的维护问题，但随着自己想法的增多再加上较好的执行力，各类型网站的数量「爆炸式」增长，为求快而施展「CV 大法」，导致了较为严重的维护和未来复用的问题……"> <meta property="og:description" content="起初只有一个做内容分享的网站时，不存在主题的维护问题，但随着自己想法的增多再加上较好的执行力，各类型网站的数量「爆炸式」增长，为求快而施展「CV 大法」，导致了较为严重的维护和未来复用的问题……"> <link rel="canonical" href="https://s.ourai.ws/projects/lfhxk50o/"> <meta property="og:url" content="https://s.ourai.ws/projects/lfhxk50o/"> <meta property="og:site_name" content="欧雷共享的内容"> <script type="application/ld+json"> { "@context" : "http://schema.org", "@type" : "WebSite", "name" : "欧雷共享的内容", "url" : "https://s.ourai.ws" } </script> <meta property="og:type" content="article"> <meta property="article:published_time" content="2023-03-21T15:24:33+08:00"> <link rel="next" href="https://s.ourai.ws/projects/lglj5els%203/" title="以「人」为单位的信息聚合"> <link rel="prev" href="https://s.ourai.ws/projects/lfhxk50o%203/" title="网站主题 Lime 抽取并开源"> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "NewsArticle", "headline": "网站主题 Lime 抽取并开源", "image": null, "datePublished": "2023-03-21T15:24:33+08:00", "description": "起初只有一个做内容分享的网站时，不存在主题的维护问题，但随着自己想法的增多再加上较好的执行力，各类型网站的数量「爆炸式」增长，为求快而施展「CV 大法」，导致了较为严重的维护和未来复用的问题……" } </script> <link rel="author" href="https://s.ourai.ws"> <!-- 页面渲染兼容性 --> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="renderer" content="webkit"> <meta name="viewport" content="width=device-width,initial-scale=1.0"> <meta name="theme-color" content="#0871ab"> <link rel="icon" href="/assets/favicon-3e749ca030e3b71eb2662d947c789061d2da9e0f4ee5f3360cfa9ccbe053c8ba.ico"> <!-- 静态资源 --> <link type="text/css" rel="stylesheet" href="/assets/disqusjs.min-b077139304675330d06888b873bd88158951637593a3c17c4674bc855caf71af.css"> <link type="text/css" rel="stylesheet" href="/assets/global-b623500154e70cdef18bd463a0ef409c46da6d1ad99756cf169ddb354874bcbc.css"> <link type="text/css" rel="stylesheet" href="/assets/share-2811f36e337fef8021089414f657904b7e88db17d8ecade0688c8c3f5e632a5c.css"> <link type="text/css" rel="stylesheet" href="/assets/pages/post-d5f1244d69bfc31e3c7b73b16140ed8a09f0b5af40515abeae522bee80e92ec9.css"> <script type="text/javascript" src="/assets/statistic-52fc2b63e026fefad6d243ba0e5c7eb4179734e8d7b817d5ba5659c023f0f71f.js"></script> <script type="text/javascript" src="/assets/global-b3a80dd53acf48ad7228d6fd741dba15d3845cbc3783bdbbf7244151a45628aa.js"></script> <!--[if lt IE 9]> <script type="text/javascript" src="/assets/support_ie8-e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.js"></script> <![endif]--> </head> <body class="Page" itemscope itemtype="http://schema.org/WebPage"> <header class="Page-header"> <div class="navbar navbar-static-top"> <div class="container"> <div class="navbar-header"> <button class="navbar-toggle collapsed" type="button" data-target=".Page-navs" data-toggle="collapse"> <span class="sr-only">切换导航</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <div class="navbar-brand"><a href="https://ourai.ws/?utm_source=s.ourai.ws&utm_medium=common-header" title="访问「欧雷流」" target="_blank" rel="external nofollow">Ourai.WS</a><a href="/" title="回到首页">共享</a></div> </div> <nav class="Page-navs navbar-collapse collapse"> <ul class="nav navbar-nav navbar-right"> <li><a href="https://ourai.ws/?utm_source=s.ourai.ws&utm_medium=common-header" target="_blank" rel="external nofollow">主站</a></li> <li class="dropdown"> <a class="dropdown-toggle" href="/about/" data-toggle="dropdown">关于 <span class="caret"></span></a> <ul class="dropdown-menu"> <li><a href="https://linxoid.com/ourai/?utm_source=s.ourai.ws&utm_medium=common-header" target="_blank" rel="external nofollow">站长</a></li> <li class="divider"></li> <li><a href="https://ourai.ws/sponsor/?utm_source=s.ourai.ws&utm_medium=common-header" target="_blank" rel="external nofollow">赞助</a></li> <li><a href="https://yaol.in/cooperation/?utm_source=s.ourai.ws&utm_medium=common-header" target="_blank" rel="external nofollow">合作</a></li> </ul> </li> </ul> </nav> </div> </div> </header> <main class="Page-content"> <!-- 内容主体 --> <div class="container"> <article class="Page-main Article"> <header class="Article-header"> <h1 class="Article-title">网站主题 Lime 抽取并开源</h1> <p><a href="https://linxoid.com/ourai/" target="_blank" rel="external nofollow">欧雷</a> 发表于 <time datetime="2023-03-21T15:24:33+08:00">2023-03-21 15:24:33</time></p> </header> <div class="Article-content col-md-9"><p>起初只有一个做内容分享的网站时，不存在主题的维护问题，但随着自己想法的增多再加上较好的执行力，各类型网站的数量「爆炸式」增长，为求快而施展「CV 大法」，导致了较为严重的维护和未来复用的问题……</p> <p>是时候将使用多年的网站主题提取出来了，考虑到会有其他人喜欢且想用，打算把整理后的代码作为独立 Git 仓库开源；除了能在 Jekyll 中用之外，再增加对 Hexo 的支持，并可通过纯样式与交互的方式使用。</p> <h2 id="section">需求分析</h2> <p>要完成这个项目的需求，大概会经过如下几步：</p> <ol> <li>将已存在各网站中「版本」最新的样式、交互与模板整理出来并存放在新开的独立 Git 仓库中；</li> <li>合理划分可复用资源的文件目录结构并归一化相关配置以便于自动化操作及用户自定义；</li> <li>用 Hexo 的机制实现一遍相关功能；</li> <li>独立于静态网站生成器的纯样式与交互的使用方式。</li> </ol> <p>除了功能方面，还需要编写较为详细的使用手册并搭建可演示的在线文档站。</p> <p>以上工作完成后，先结合 <a href="https://knosysio.github.io/">KnoSys</a> 把持有的网站中原本分布式维护的文件全部替换为集中式自动化及自定义扩展的方式；再对外适当宣传以吸引用户，为日后用户驱动的迭代方式做铺垫。</p> <h2 id="section-1">设计</h2> <h3 id="section-2">目录结构</h3> <p>受不同静态网站生成器本身机制的限制，实际的目录结构会有些许差异；即便如此，亦可在一定程度上将结构固化下来，在此将可固化结构的「根节点」用 <code>[CURABLE_ROOT]</code> 的形式表示——</p> <h4 id="section-3">静态资源</h4> <p>先按照资源类型去划分「根节点」：</p> <table> <thead> <tr> <th>资源类型</th> <th>根节点</th> </tr> </thead> <tbody> <tr> <td>字体</td> <td><code>[FONT_ROOT]</code></td> </tr> <tr> <td>图片</td> <td><code>[IMAGE_ROOT]</code></td> </tr> <tr> <td>样式</td> <td><code>[STYLE_ROOT]</code></td> </tr> <tr> <td>脚本</td> <td><code>[SCRIPT_ROOT]</code></td> </tr> </tbody> </table> <p>再根据功能类别去拆分文件夹：</p> <table> <thead> <tr> <th>功能类别</th> <th>文件夹</th> <th>所属资源类型</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>组件</td> <td><code>components</code></td> <td>样式、脚本</td> <td>可被组合，按需引用</td> </tr> <tr> <td>页面</td> <td><code>pages</code></td> <td>样式、脚本</td> <td>可被组合，按需引用</td> </tr> <tr> <td>供应商</td> <td><code>vendors</code></td> <td>字体、样式、脚本</td> <td>-</td> </tr> <tr> <td>头图</td> <td><code>banners</code></td> <td>图片</td> <td>-</td> </tr> <tr> <td>初始化</td> <td><code>initializers</code></td> <td>脚本</td> <td>-</td> </tr> <tr> <td>补丁</td> <td><code>polyfills</code></td> <td>字体、样式</td> <td>只在 Hexo 中使用</td> </tr> </tbody> </table> <h4 id="section-4">动态模板</h4> <p>片段：</p> <figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>[PARTIAL_ROOT]
   ├── components
   │   └── ...
   ├── partials
   │   └── ...
   ├── slots
   │   └── ...
   └── widgets
       └── ...</code></pre></figure> <p>布局：</p> <figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>[LAYOUT_ROOT]
   └── ...</code></pre></figure> <p>页面：</p> <figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>[PAGE_ROOT]
   └── ...</code></pre></figure> <h3 id="section-5">模板片段</h3> <p>即「partial」，是对 HTML 进行拆分后的一部分结构，有些是可复用的。</p> <h4 id="section-6">常规</h4> <p>每个页面顶多会用到一次的非功能性片段，存放于 <code>[PARTIAL_ROOT]/partials</code> 文件夹：</p> <table> <thead> <tr> <th>名称/路径</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td><code>meta/seo</code></td> <td>SEO 相关标签</td> </tr> <tr> <td><code>meta/render</code></td> <td>页面渲染及兼容性相关标签</td> </tr> <tr> <td><code>meta/feed</code></td> <td>Feed 订阅相关标签</td> </tr> <tr> <td><code>meta/brand</code></td> <td>网站品牌相关标签</td> </tr> <tr> <td><code>head</code></td> <td><code>&lt;head&gt;</code> 内非样式与脚本内容</td> </tr> <tr> <td><code>header</code></td> <td>页面头部</td> </tr> <tr> <td><code>footer</code></td> <td>页面底部</td> </tr> </tbody> </table> <h4 id="section-7">组件</h4> <p>多次使用的一般性可复用片段，通常会传入参数，存放于 <code>[PARTIAL_ROOT]/components</code> 文件夹：</p> <table> <thead> <tr> <th>名称</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td><code>link</code></td> <td>用于站内或站外链接的 <code>&lt;a&gt;</code> 标签</td> </tr> <tr> <td><code>brand-link</code></td> <td>网站品牌链接</td> </tr> <tr> <td><code>nav-list</code></td> <td>导航菜单条目列表</td> </tr> <tr> <td><code>copyright</code></td> <td>版权声明文本及链接</td> </tr> <tr> <td><code>doc-toc</code></td> <td>用于使用指南、API 文档等的文档目录树</td> </tr> </tbody> </table> <h4 id="section-8">部件</h4> <p>为完成特定业务功能的片段，没有传入的参数，存放于 <code>[PARTIAL_ROOT]/widgets</code> 文件夹：</p> <table> <thead> <tr> <th>名称</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td><code>disqus</code></td> <td>Disqus 评论框</td> </tr> <tr> <td><code>comment</code></td> <td>综合评论框</td> </tr> <tr> <td><code>share</code></td> <td>分享到 SNS</td> </tr> <tr> <td><code>toc</code></td> <td>页内目录树</td> </tr> </tbody> </table> <h4 id="section-9">插槽</h4> <p>对下文中所描述的「内容插槽」的使用及默认处理，存放于 <code>[PARTIAL_ROOT]/slots</code> 文件夹：</p> <table> <thead> <tr> <th>名称</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td><code>banner</code></td> <td>头图，对应插槽 <code>banner</code></td> </tr> <tr> <td><code>header</code></td> <td>头部，对应插槽 <code>header</code>、<code>title</code> 和 <code>meta</code></td> </tr> <tr> <td><code>footer</code></td> <td>底部，对应插槽 <code>footer</code></td> </tr> <tr> <td><code>aside</code></td> <td>侧边栏，对应插槽 <code>aside</code></td> </tr> </tbody> </table> <h3 id="section-10">布局模板</h3> <table> <thead> <tr> <th>名称</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td><code>default</code></td> <td>作为其他布局的基础结构，包含了 <code>&lt;head&gt;</code> 及其内容，继承该布局的其他布局的内容会被渲染在 <code>&lt;body&gt;</code> 内</td> </tr> <tr> <td><code>page</code></td> <td>衍生自 <code>default</code>，用于常规页面</td> </tr> <tr> <td><code>post</code></td> <td>衍生自 <code>page</code>，用于文章</td> </tr> <tr> <td><code>doc</code></td> <td>衍生自 <code>default</code>，用于使用指南、API 文档等</td> </tr> <tr> <td><code>blank</code></td> <td>没有任何 HTML 标签，完全空白</td> </tr> <tr> <td><code>hack</code></td> <td>只在 Hexo 中使用，用于支持通过页面配置默认值指定的动态布局</td> </tr> </tbody> </table> <h4 id="section-11">内容插槽</h4> <p>为提高用户自定义页面的扩展自由度，布局中的部分区域除了可通过全局或页面的配置对预置功能进行控制，还可添加内容区域自定义的内容块：</p> <table> <thead> <tr> <th>名称</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td><code>banner</code></td> <td>头图</td> </tr> <tr> <td><code>header</code></td> <td>头部</td> </tr> <tr> <td><code>title</code></td> <td>标题</td> </tr> <tr> <td><code>meta</code></td> <td>作者、标签等信息</td> </tr> <tr> <td><code>content</code></td> <td>正文</td> </tr> <tr> <td><code>footer</code></td> <td>底部，大尺寸设备中视觉上是正文右侧</td> </tr> <tr> <td><code>aside</code></td> <td>侧边栏</td> </tr> </tbody> </table> <p>实现方案有以下几种：</p> <ol> <li>在布局中通过模板片段的方式引用页面配置中以 <code>ksio_slot_[SLOT_NAME]</code> 形式定义的文件路径；</li> <li>通过静态网站生成器的机制将页面中定义的内容块设置为构建流程中的某个变量，再在布局中判断并输出。</li> </ol> <p>其中，第一个方案实现成本低很多，不需要深入了解静态网站生成器的相关机制。</p> <h3 id="section-12">内置页面</h3> <table> <thead> <tr> <th>名称</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td><code>index</code></td> <td>首页</td> </tr> <tr> <td><code>404</code></td> <td>未找到资源</td> </tr> <tr> <td><code>posts</code></td> <td>文章列表</td> </tr> </tbody> </table> <h3 id="section-13">全局配置</h3> <p>将用于控制主题模板中预置渲染逻辑的配置项通过 TypeScript 的类型定义 <code>ThemeConfig</code> 进行表示：</p> <figure class="highlight"><pre><code class="language-ts" data-lang="ts"><span></span><span class="kd">interface</span> <span class="nx">Link</span> <span class="p">{</span>
  <span class="k">readonly</span> <span class="nx">text</span>: <span class="kt">string</span><span class="p">;</span>
  <span class="k">readonly</span> <span class="nx">url?</span>: <span class="kt">string</span><span class="p">;</span>
  <span class="k">readonly</span> <span class="nx">children?</span>: <span class="kt">Link</span><span class="p">[];</span>
<span class="p">}</span>

<span class="kd">interface</span> <span class="nx">BrandConfig</span> <span class="p">{</span>
  <span class="k">readonly</span> <span class="nx">color?</span>: <span class="kt">string</span><span class="p">;</span> <span class="c1">// 品牌主题色</span>
  <span class="k">readonly</span> <span class="nx">icon?</span>: <span class="kt">string</span><span class="p">;</span>  <span class="c1">// 品牌图标，默认为主题自带的 `favicon.ico`</span>
  <span class="k">readonly</span> <span class="nx">parent?</span>: <span class="kt">Link</span><span class="p">;</span>  <span class="c1">// 当前网站的父品牌，指定后会在当前网站品牌的左边显示</span>
  <span class="k">readonly</span> <span class="nx">text?</span>: <span class="kt">string</span><span class="p">;</span>  <span class="c1">// 当前网站品牌所要显示的文本，不指定则显示网站标题，默认为网站标题</span>
<span class="p">}</span>

<span class="kd">interface</span> <span class="nx">CopyrightPeriod</span> <span class="p">{</span>
  <span class="k">readonly</span> <span class="nx">start?</span>: <span class="kt">Date</span> <span class="o">|</span> <span class="kt">string</span> <span class="o">|</span> <span class="kt">number</span><span class="p">;</span>  <span class="c1">// 起始时间，一般只有年份，默认使用网站构建时间</span>
<span class="p">}</span>

<span class="kd">interface</span> <span class="nx">CopyrightConfig</span> <span class="p">{</span>
  <span class="k">readonly</span> <span class="nx">fragments?</span>: <span class="kt">string</span><span class="p">;</span>  <span class="c1">// 显示在版权声明右侧的额外信息，值是可以包含 HTML 的字符串</span>
  <span class="k">readonly</span> <span class="nx">owner?</span>: <span class="kt">Link</span><span class="p">;</span>  <span class="c1">// 版权所有人，默认使用网站标题与地址</span>
  <span class="k">readonly</span> <span class="nx">period?</span>: <span class="kt">CopyrightPeriod</span><span class="p">;</span>  <span class="c1">// 有效期间</span>
  <span class="k">readonly</span> <span class="nx">provider?</span>: <span class="kt">boolean</span><span class="p">;</span>  <span class="c1">// 是否显示主题与提供者声明，默认为 `true`</span>
<span class="p">}</span>

<span class="kd">interface</span> <span class="nx">FooterConfig</span> <span class="p">{</span>
  <span class="k">readonly</span> <span class="nx">links?</span>: <span class="kt">Link</span><span class="p">[];</span>  <span class="c1">// 页面底部链接</span>
  <span class="k">readonly</span> <span class="nx">partial?</span>: <span class="kt">string</span><span class="p">;</span>  <span class="c1">// 预置布局模板中页脚部分，可指定自定义的替换主题预置的</span>
<span class="p">}</span>

<span class="kd">interface</span> <span class="nx">HeaderNavBar</span> <span class="p">{</span>
  <span class="k">readonly</span> <span class="nx">placement</span><span class="o">?:</span> <span class="s1">&#39;left&#39;</span> <span class="o">|</span> <span class="s1">&#39;right&#39;</span><span class="p">;</span>  <span class="c1">// 导航菜单显示位置，默认为 `&#39;left&#39;`</span>
<span class="p">}</span>

<span class="kd">interface</span> <span class="nx">HeaderConfig</span> <span class="p">{</span>
  <span class="k">readonly</span> <span class="nx">navbar?</span>: <span class="kt">HeaderNavBar</span><span class="p">;</span> <span class="c1">// 页头导航栏</span>
  <span class="k">readonly</span> <span class="nx">navs?</span>: <span class="kt">Link</span><span class="p">[];</span> <span class="c1">// 页面头部导航</span>
  <span class="k">readonly</span> <span class="nx">partial?</span>: <span class="kt">string</span><span class="p">;</span>  <span class="c1">// 预置布局模板中页头部分，可指定自定义的替换主题预置的</span>
<span class="p">}</span>

<span class="kd">interface</span> <span class="nx">MasterConfig</span> <span class="p">{</span>
  <span class="k">readonly</span> <span class="nx">name?</span>: <span class="kt">string</span><span class="p">;</span> <span class="c1">// 站长名称</span>
<span class="p">}</span>

<span class="kd">interface</span> <span class="nx">MetaConfig</span> <span class="p">{</span>
  <span class="k">readonly</span> <span class="nx">url</span>: <span class="kt">string</span><span class="p">;</span> <span class="c1">// 网站发布后的访问链接</span>
<span class="p">}</span>

<span class="kd">interface</span> <span class="nx">SeoConfig</span> <span class="p">{</span>
  <span class="k">readonly</span> <span class="nx">suffix?</span>: <span class="kt">boolean</span><span class="p">;</span>  <span class="c1">// 是否在 `&lt;title&gt;` 中将站名作为后缀拼接，默认为 `true`</span>
<span class="p">}</span>

<span class="kd">interface</span> <span class="nx">SocialComment</span> <span class="p">{</span>
  <span class="c1">// Disqus</span>
  <span class="k">readonly</span> <span class="nx">disqus</span><span class="o">?:</span> <span class="p">{</span>
    <span class="nx">shortname</span>: <span class="kt">string</span><span class="p">;</span>  <span class="c1">// Disqus 上注册的网站名</span>
    <span class="c1">// 以下几个配置项是在无法加载 Disqus 的情况下的代理，</span>
    <span class="c1">// 默认为 DisqusJS（详见 https://disqusjs.skk.moe/）</span>
    <span class="nx">proxy</span><span class="o">?:</span> <span class="p">{</span>
      <span class="nx">endpoint</span>: <span class="kt">string</span><span class="p">;</span> <span class="c1">// 用于 DisqusJS 的 `api` 配置项</span>
      <span class="nx">key</span>: <span class="kt">string</span><span class="p">;</span>  <span class="c1">// 用于 DisqusJS 的 `apikey` 配置项</span>
    <span class="p">};</span>
    <span class="nx">username?</span>: <span class="kt">string</span><span class="p">;</span>  <span class="c1">// 用于 DisqusJS 的 `admin` 配置项</span>
    <span class="nx">label?</span>: <span class="kt">string</span><span class="p">;</span> <span class="c1">// 用于 DisqusJS 的 `adminLabel` 配置项</span>
  <span class="p">};</span>
  <span class="c1">// 多说</span>
  <span class="k">readonly</span> <span class="nx">duoshuo</span><span class="o">?:</span> <span class="p">{</span>
    <span class="nx">shortname?</span>: <span class="kt">string</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="kd">interface</span> <span class="nx">SocialFeed</span> <span class="p">{</span>
  <span class="k">readonly</span> <span class="nx">rss?</span>: <span class="kt">boolean</span><span class="p">;</span> <span class="c1">// 是否生成 RSS feed，默认为 `false`，会用到 `meta.url`</span>
  <span class="k">readonly</span> <span class="nx">atom?</span>: <span class="kt">boolean</span><span class="p">;</span>  <span class="c1">// 是否生成 Atom feed，默认为 `false`</span>
<span class="p">}</span>

<span class="kd">interface</span> <span class="nx">SocialConfig</span> <span class="p">{</span>
  <span class="k">readonly</span> <span class="nx">comment?</span>: <span class="kt">SocialComment</span><span class="p">;</span> <span class="c1">// 评论功能</span>
  <span class="k">readonly</span> <span class="nx">feed?</span>: <span class="kt">SocialFeed</span><span class="p">;</span> <span class="c1">// Feed 订阅功能</span>
  <span class="k">readonly</span> <span class="nx">share?</span>: <span class="kt">boolean</span><span class="p">;</span> <span class="c1">// 是否启用将页面分享到其他 SNS 的按钮，默认为 `true`</span>
<span class="p">}</span>

<span class="kd">interface</span> <span class="nx">AnalyticsConfig</span> <span class="p">{</span>
  <span class="c1">// TODO</span>
<span class="p">}</span>

<span class="kd">interface</span> <span class="nx">ThemeConfig</span> <span class="p">{</span>
  <span class="k">readonly</span> <span class="nx">brand?</span>: <span class="kt">BrandConfig</span><span class="p">;</span> <span class="c1">// 品牌相关配置，主要控制页头左上角的链接与文本</span>
  <span class="k">readonly</span> <span class="nx">copyright?</span>: <span class="kt">CopyrightConfig</span><span class="p">;</span> <span class="c1">// 网站版权声明</span>
  <span class="k">readonly</span> <span class="nx">footer?</span>: <span class="kt">FooterConfig</span><span class="p">;</span> <span class="c1">// 页面底部</span>
  <span class="k">readonly</span> <span class="nx">header?</span>: <span class="kt">HeaderConfig</span><span class="p">;</span> <span class="c1">// 页面头部</span>
  <span class="k">readonly</span> <span class="nx">master?</span>: <span class="kt">MasterConfig</span><span class="p">;</span> <span class="c1">// 站长信息</span>
  <span class="k">readonly</span> <span class="nx">meta?</span>: <span class="kt">MetaConfig</span><span class="p">;</span> <span class="c1">// 网站信息</span>
  <span class="k">readonly</span> <span class="nx">seo?</span>: <span class="kt">SeoConfig</span><span class="p">;</span> <span class="c1">// SEO 相关配置</span>
  <span class="k">readonly</span> <span class="nx">social?</span>: <span class="kt">SocialConfig</span><span class="p">;</span> <span class="c1">// 社交相关功能的开关与配置</span>
  <span class="k">readonly</span> <span class="nx">analytics?</span>: <span class="kt">AnalyticsConfig</span><span class="p">;</span> <span class="c1">// 数据统计相关配置</span>
<span class="p">}</span></code></pre></figure> <h3 id="section-14">页面配置</h3> <p>即定义在 Front Matter 中的变量，除了会用到静态网站生成器预定义与约定俗成的变量之外，主题内也自定义了一些——</p> <h4 id="seo">SEO</h4> <p>影响生成 SEO 相关信息的变量：</p> <table> <thead> <tr> <th>变量名</th> <th>值类型/可选值</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td><code>ksio_seo_title</code></td> <td><code>string</code></td> <td>显示在 <code>&lt;title&gt;</code> 中的页面标题，不指定则使用 <code>title</code></td> </tr> <tr> <td><code>ksio_seo_role</code></td> <td><code>'writer' | 'developer'</code></td> <td>根据角色生成特定的页面描述</td> </tr> </tbody> </table> <h4 id="section-15">资源注入</h4> <p>除了整站共用的个别静态资源会写死在 <code>&lt;/head&gt;</code> 与 <code>&lt;/body&gt;</code> 前方之外，有些只跟特定布局和页面绑定的静态资源得按需注入，可与设置页面配置默认值的能力相结合：</p> <table> <thead> <tr> <th>变量名</th> <th>值类型/可选值</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td><code>ksio_asset_js</code></td> <td><code>string | string[]</code></td> <td>省略扩展名的 JS 文件路径</td> </tr> <tr> <td><code>ksio_asset_css</code></td> <td><code>string | string[]</code></td> <td>省略扩展名的 CSS 文件路径</td> </tr> </tbody> </table> <h4 id="section-16">布局插槽</h4> <p>详见上文中对「内容插槽」的描述。</p> <h4 id="section-17">功能开关</h4> <table> <thead> <tr> <th>变量名</th> <th>值类型/可选值</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td><code>ksio_shareable</code></td> <td><code>boolean</code></td> <td>是否显示分享按钮</td> </tr> </tbody> </table> <h3 id="section-18">生成适配</h3> <p>为了主题预置功能可以正常运作而针对不同的静态网站生成器进行适配，在实际使用时很可能会受具体环境限制而有所差异。</p> <h4 id="section-19">文件路径</h4> <p>无论是 Jekyll 还是 Hexo，主题所提供的文件都放在 <code>ksio</code> 或 <code>_ksio</code> 文件夹（中的某个子孙文件夹）内；上文中定义的形式化的「根节点」具体分别为：</p> <table> <thead> <tr> <th>根节点</th> <th>Jekyll</th> <th>Hexo</th> </tr> </thead> <tbody> <tr> <td><code>[FONT_ROOT]</code></td> <td><code>_assets/fonts/ksio</code></td> <td><code>source/fonts/ksio</code></td> </tr> <tr> <td><code>[IMAGE_ROOT]</code></td> <td><code>_assets/images/ksio</code></td> <td><code>source/images/ksio</code></td> </tr> <tr> <td><code>[STYLE_ROOT]</code></td> <td><code>_assets/stylesheets/ksio</code></td> <td><code>source/stylesheets/ksio</code></td> </tr> <tr> <td><code>[SCRIPT_ROOT]</code></td> <td><code>_assets/javascripts/ksio</code></td> <td><code>source/javascripts/ksio</code></td> </tr> <tr> <td><code>[PARTIAL_ROOT]</code></td> <td><code>_includes/ksio</code></td> <td><code>layout/_ksio</code></td> </tr> <tr> <td><code>[LAYOUT_ROOT]</code></td> <td><code>_layouts/ksio</code></td> <td><code>layout/_ksio/layouts</code></td> </tr> <tr> <td><code>[PAGE_ROOT]</code></td> <td><code>_pages</code></td> <td><code>layout/_ksio/pages</code></td> </tr> </tbody> </table> <h4 id="section-20">主题配置</h4> <p>在 Hexo 中，可通过<a href="https://hexo.io/zh-cn/docs/configuration#%E4%BD%BF%E7%94%A8%E4%BB%A3%E6%9B%BF%E4%B8%BB%E9%A2%98%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">指定方式</a>为主题进行全局配置；而 Jekyll 并没有指定的配置方式，故主题的全局配置都挂在<a href="https://jekyllrb.com/docs/configuration/">配置文件</a>中的 <code>ksio</code> 下面：</p> <figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span></span><span class="nt">ksio</span><span class="p">:</span>
  <span class="nt">brand</span><span class="p">:</span>
    <span class="nt">color</span><span class="p">:</span> <span class="s">&quot;#0871ab&quot;</span>
  <span class="nt">copyright</span><span class="p">:</span>
    <span class="nt">owner</span><span class="p">:</span>
      <span class="nt">text</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">欧雷流</span>
      <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://ourai.ws/</span></code></pre></figure> <p>在 Jekyll 中可按匹配规则为页面配置<a href="https://jekyllrb.com/docs/configuration/front-matter-defaults/">设置默认值</a>，而 Hexo 不具备此机制，需要利用<a href="https://hexo.io/zh-cn/api/filter#template-locals">过滤器</a>实现下：</p> <figure class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="nx">hexo</span><span class="p">.</span><span class="nx">extend</span><span class="p">.</span><span class="nx">filter</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;template_locals&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">locals</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="cm">/* 将默认值赋给匹配到的文件 */</span><span class="p">};</span>

  <span class="nx">locals</span><span class="p">.</span><span class="nx">page</span> <span class="o">=</span> <span class="p">{</span> <span class="p">...</span><span class="nx">locals</span><span class="p">.</span><span class="nx">page</span><span class="p">,</span> <span class="p">...</span><span class="nx">defaults</span> <span class="p">};</span>

  <span class="k">return</span> <span class="nx">locals</span><span class="p">;</span>
<span class="p">});</span></code></pre></figure> <p>这个方式有局限——</p> <p>改变 <code>page.layout</code> 并无法影响 Hexo 所要渲染的布局模板，即与文件页面配置中的 <code>layout</code> 不等效。先通过主题内置的布局模板动态调整下，过后了解 Hexo 的内部流程后再实现个完美的。</p> <p>另外，不知什么原因，<code>before_post_render</code> 和 <code>after_post_render</code> 这两个过滤器都不起作用，在了解 Hexo 机制时顺便排查下。</p> <h4 id="section-21">组件片段</h4> <p>在 Jekyll 和 Hexo 中并没有「组件」相关支持，但通过它们所提供的片段复用机制可以进行一定程度上的模拟——</p> <p>在 Jekyll 中是 <a href="https://jekyllrb.com/docs/includes/"><code>include</code></a> 标签，片段中用到的变量在使用时可不必显式传入：</p> <figure class="highlight"><pre><code class="language-html" data-lang="html"><span></span><span class="c">&lt;!-- 定义片段 `ksio/components/link.html` --&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;javascript:void(0);&quot;</span><span class="p">&gt;</span>{% if include.wrap %}<span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>链接<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>{% else %}链接{% endif %}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>

<span class="c">&lt;!-- 使用片段 --&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{% include ksio/components/link.html %}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span></code></pre></figure> <p>在 Hexo 中是 <a href="https://hexo.io/zh-cn/docs/helpers#partial"><code>partial</code></a> 函数，片段中用到的变量在使用时必须显式传入：</p> <figure class="highlight"><pre><code class="language-html" data-lang="html"><span></span><span class="c">&lt;!-- 定义片段 `_ksio/components/link.ejs` --&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;javascript:void(0);&quot;</span><span class="p">&gt;</span><span class="err">&lt;</span>% if (wrap) { %&gt;<span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>链接<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span><span class="err">&lt;</span>% } else { %&gt;链接<span class="err">&lt;</span>% } %&gt;<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>

<span class="c">&lt;!-- 使用片段 --&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="err">&lt;</span>%- partial(&#39;_ksio/components/link&#39;, { wrap: false }) %&gt;<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span></code></pre></figure> <p>为保持使用时的一致性，在 <code>include</code> 标签和 <code>partial</code> 函数中的片段路径是基于各自指定目录结构的相对路径，即相对于 <code>_includes</code> 的 <code>ksio/components/link.html</code> 或相对于 <code>layout</code> 的 <code>_ksio/components/link</code>。</p> <h4 id="section-22">代码高亮</h4> <p>假如是要在文章中展示，无论是 Jekyll 或是 Hexo，都需先自建一个 <code>post.scss</code> 文件，里面引入主题预置的样式片段：</p> <figure class="highlight"><pre><code class="language-scss" data-lang="scss"><span></span><span class="c1">// `stylesheets/pages/post.scss`</span>
<span class="k">@import</span> <span class="s2">&quot;../ksio/pages/post&quot;</span><span class="p">;</span></code></pre></figure> <p>若是使用 Jekyll，需在配置文件中设置 <code>highlighter: pygments</code>，再在 <code>post.scss</code> 中添加高亮样式文件的引用：</p> <figure class="highlight"><pre><code class="language-scss" data-lang="scss"><span></span><span class="c1">// `stylesheets/pages/post.scss`</span>
<span class="k">@import</span> <span class="s2">&quot;../ksio/pages/post&quot;</span><span class="p">;</span>
<span class="k">@import</span> <span class="s2">&quot;../ksio/syntax-highlighting&quot;</span><span class="p">;</span></code></pre></figure> <p>在 Hexo 中则通过页面配置 <code>ksio_asset_css</code> 添加。</p> <h3 id="section-23">发布版本</h3> <p>新建 <code>release</code> 分支专门用于存放发版文件，根据使用场景将相关文件打包成压缩包后在<a href="https://github.com/ourai/lime/releases">发版页面</a>提供下载。</p> <h3 id="section-24">使用方式</h3> <h4 id="section-25">独立使用</h4> <h2 id="tasks">任务</h2> <h3 id="section-26">处理中 (1)</h3> <ul> <li>独立于静态网站生成器使用的样式与交互</li> </ul> <h3 id="section-27">未开始 (1)</h3> <ul> <li>发版自动化脚本</li> </ul> <h3 id="section-28">已完成 (10)</h3> <ul> <li>将个人网站与各 API 文档站的通用文件抽取出来</li> <li>集中管理主题预置文件</li> <li>使页头中的元素可配置并动态渲染</li> <li>使页脚中的元素可配置并动态渲染</li> <li>页头与页脚可使用用户自定义文件</li> <li>统一主题相关配置定义与使用方式</li> <li>Hexo 模板适配</li> <li>Hexo 中用于设置 Front Matter 默认值的插件</li> <li>字体文件引用适配</li> <li>代码高亮适配</li> </ul> </div> <footer class="Article-footer col-md-3"> <div class="Widget Widget--share"> <div class="Widget-body"> <p>分享到<i class="fa fa-share-alt"></i></p> <div class="social-share" data-sites="wechat,weibo,twitter"></div> </div> </div> <section class="Widget Widget--toc"> <div class="Widget-header"> <h2 class="Widget-title">目录</h2> </div> <div class="Widget-body"></div> </section> </footer> </article> </div> </main> <footer class="Page-footer Footer"> <div class="container"> <div class="Footer-description"> <!-- 重要链接 --> <nav class="Footer-navs"> <ul> <li><a href="https://meta.ourai.ws/?utm_source=s.ourai.ws&utm_medium=common-footer" title="访问「欧雷宇宙」" target="_blank" rel="external nofollow"><span>@</span></a></li> <li><a href="https://ourai.ws/sponsor/?utm_source=s.ourai.ws&utm_medium=common-footer" target="_blank" rel="external nofollow"><span>赞助</span></a></li> <li><a href="https://yaol.in/cooperation/?utm_source=s.ourai.ws&utm_medium=common-footer" target="_blank" rel="external nofollow"><span>合作</span></a></li> </ul> </nav> <!-- 网站版权 --> <div class="Footer-copyright"> <p>&copy; 2022-2024 <a href="https://ourai.ws/?utm_source=s.ourai.ws&utm_medium=common-footer" target="_blank" rel="external nofollow">欧雷流</a> 版权所有</p> <p>采用 <a href="http://jekyllrb.com" target="_blank" rel="external nofollow">Jekyll</a> 生成</p> </div> </div> </div> </footer> <script type="text/javascript" src="/assets/share.min-3155ee636b84a04d036e0f1ba833227d3fd03a4c58a6f2e21c9ceb1c5d0198c7.js"></script><script type="text/javascript" src="/assets/components-a266f21fe1dfd61bebf40e74872cbf901eb3e201f7d33e9e5d5af9a55f4b24ea.js"></script> <script type="text/javascript" src="/assets/initializers/time-8d7a529a66ae6cb53c2283d21fd6a12c538b8473dd5bd76458366d09adce7bf6.js"></script><script type="text/javascript" src="/assets/initializers/lazyload-44b7df8a9282d598284d522e64d6be9ac88d466f3c4a734a514303e99347b2c9.js"></script><script type="text/javascript" src="/assets/pages/note-9ab3eb6df1d3fddf84b58d43559834cd8185c6e5e020afa35bb2c51247538efa.js"></script> </body> </html>
