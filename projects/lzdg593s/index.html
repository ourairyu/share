<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="UTF-8">









  
  
  
    
  


  


  


  










  <title>Selfverse 黑客松概念版 - 欧雷共享的内容</title>


  <meta property="og:title" content="Selfverse 黑客松概念版">




  
    
  


  <meta name="keywords" content="欧雷,欧雷流">


<!-- 页面渲染兼容性 -->
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="renderer" content="webkit">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!-- 订阅 -->

<meta name="theme-color" content="#0871ab">
<link rel="shortcut icon" href="/images/ksio/favicon.ico">


    
<link rel="stylesheet" href="/stylesheets/global.css">

    
<link rel="stylesheet" href="/stylesheets/ksio/vendors/share.css">

    
<script src="/javascripts/ksio/vendors/jquery-1.11.3.min.js"></script>

    
<script src="/javascripts/ksio/vendors/bootstrap.min.js"></script>

  </head>
  
  
  <body class="Page" itemscope itemtype="http://schema.org/WebPage">
    

  <header class="Page-header">
  <div class="navbar navbar-static-top">
    <div class="container">
      <div class="navbar-header">
        
          <button class="navbar-toggle collapsed" type="button" data-target=".Page-navs" data-toggle="collapse">
            <span class="sr-only">Toggle navs</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        
        
          <div class="navbar-brand">


  <a href="https://ourai.ws/?utm_source=https://s.ourai.ws&utm_medium=brand" target="_blank" rel="external nofollow">Ourai.WS</a><a href="/">共享</a>

</div>
        
      </div>
      <!-- Nav menus -->
      <nav class="Page-navs navbar-collapse collapse">
        <ul class="nav navbar-nav navbar-right">
          
  
    <li><a href="https://ourai.ws/?utm_source=https://s.ourai.ws&amp;utm_medium=common-header" target="_blank" rel="external nofollow">主站</a>
</li>
  

  
    <li class="dropdown">
      <a class="dropdown-toggle" href="javascript:void(0);" data-toggle="dropdown">关于 <span class="caret"></span></a>
      <ul class="dropdown-menu">
  
    <li><a href="https://linxoid.com/ourai/?utm_source=https://s.ourai.ws&amp;utm_medium=common-header" target="_blank" rel="external nofollow">站长</a>
</li>
  

  
    <li><a href="https://ourai.ws/sponsor/?utm_source=https://s.ourai.ws&amp;utm_medium=common-header" target="_blank" rel="external nofollow">赞助</a>
</li>
  

  
    <li><a href="https://yaol.in/cooperation/?utm_source=https://s.ourai.ws&amp;utm_medium=common-header" target="_blank" rel="external nofollow">合作</a>
</li>
  

</ul>
    </li>
  


        </ul>
      </nav>
    </div>
  </div>
</header>

<main class="Page-content">
  

  <!-- 内容主体 -->
  <div class="container">
    <article class="Page-main Article">
      <header class="Article-header">
        
  
    <h1 class="Article-title">Selfverse 黑客松概念版</h1>
  
  


      </header>
      <div class="Article-content col-md-9"><p>本项目的初期目标是开发一个无传统服务端的纯 dApp 实现《<a href="../../../../../summarization/notes/2024/08/03-010447/readme.md">把自己打造成超级个体</a>》中的部分功能雏形，可将其简单理解为是 <a target="_blank" rel="noopener" href="https://crossbell.io/">Crossbell</a> 相关产品的纯个人版（自部署&#x2F;自托管）。</p>
<p>该概念版作为由 OpenBuild 组织的「<a href="../../../../../summarization/notes/2024/07/29-113434/readme.md">Web3 前端训练营线上黑客松</a>」与「<a target="_blank" rel="noopener" href="https://build.bewater.xyz/en/campaigns/rK6X-ETH-Shenzhen-Hackathon">ETH Shenzhen Hackathon</a>」的参赛作品，大致包含以下功能：</p>
<ul>
<li>常规文章的发布与展示；</li>
<li>文章可被打赏；</li>
<li>付费作品的管理与交易；</li>
<li>直接捐赠&#x2F;打赏及相关数据统计；</li>
<li>访客专属个人中心；</li>
<li>可设置系统内流通代币为原生币或稳定币。</li>
</ul>
<p>除了上述必做功能之外，视时间与精力情况选做：</p>
<ul>
<li>常规视频的发布与展示；</li>
<li>视频可被打赏；</li>
<li>文章与视频可单独收费。</li>
</ul>
<h2 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h2><p>付费作品由散装作品构成，是散装作品的合集。</p>
<p>功能梳理：</p>
<table>
<thead>
<tr>
<th>模块</th>
<th>功能点</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>系统设置</td>
<td>角色权限配置</td>
<td>设置智能合约管理员、操作员</td>
</tr>
<tr>
<td></td>
<td>流通代币配置</td>
<td></td>
</tr>
<tr>
<td>散装作品</td>
<td>散装作品列表</td>
<td></td>
</tr>
<tr>
<td></td>
<td>散装作品详情</td>
<td>可进行打赏、购买操作</td>
</tr>
<tr>
<td></td>
<td>散装作品购买</td>
<td></td>
</tr>
<tr>
<td></td>
<td>散装作品管理</td>
<td></td>
</tr>
<tr>
<td>付费作品</td>
<td>付费作品列表</td>
<td>可进行购买操作</td>
</tr>
<tr>
<td></td>
<td>付费作品详情</td>
<td>可进行购买操作</td>
</tr>
<tr>
<td></td>
<td>付费作品购买</td>
<td></td>
</tr>
<tr>
<td></td>
<td>付费作品管理</td>
<td>可进行创建、更新、上架、下架、关联散装作品操作</td>
</tr>
<tr>
<td>捐赠&#x2F;打赏</td>
<td>专门页面直接打赏</td>
<td>类似于 <a target="_blank" rel="noopener" href="https://ko-fi.com/ourai">Ko-fi</a> 这类的个人主页</td>
</tr>
<tr>
<td></td>
<td>散装作品打赏</td>
<td></td>
</tr>
<tr>
<td></td>
<td>打赏统计数据</td>
<td></td>
</tr>
<tr>
<td>专属荣誉</td>
<td>某付费作品购买者</td>
<td>需在付费作品中设置，购买作品后会自动获得被设置的 SBT</td>
</tr>
<tr>
<td></td>
<td>荣誉管理</td>
<td>可进行勋章图片设置</td>
</tr>
<tr>
<td>个人中心</td>
<td>购买记录</td>
<td>展示已购买的付费的合集作品、散装作品</td>
</tr>
<tr>
<td></td>
<td>打赏记录</td>
<td>展示直接打赏与按作品打赏的记录</td>
</tr>
</tbody></table>
<p>技术要求：</p>
<ul>
<li><del>智能合约使用可升级的方式</del>；</li>
<li>关键且必要的信息与元数据分开存储管理以便于日后将元数据迁移出去利用 KnoSys 或第三方进行存储。</li>
</ul>
<p>需要考虑：</p>
<ul>
<li>钱可能需要统一管理，所以需要专门合约；</li>
<li>访客有可能更换地址，所以需要用内部 ID 记录有过交易的访客。</li>
</ul>
<p>需要了解：</p>
<ul>
<li>链上数据的迁移问题。</li>
</ul>
<h2 id="设计"><a href="#设计" class="headerlink" title="设计"></a>设计</h2><p>本版 all in 以太坊，以实现功能为首要任务，不引入额外的技术复杂度，不过多考虑优化类问题。</p>
<p>核心组件如下：</p>
<table>
<thead>
<tr>
<th>组件</th>
<th>技术依赖</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>身份标识</td>
<td>以太坊（暂时）</td>
<td>日后跟 LinXoid 结合起来</td>
</tr>
<tr>
<td>数据存储</td>
<td>以太坊（暂时）</td>
<td>日后改用 KnoSys 或其他</td>
</tr>
<tr>
<td>经济体系</td>
<td>以太坊</td>
<td>原生币、稳定币</td>
</tr>
<tr>
<td>成就体系</td>
<td>以太坊</td>
<td>以不可转移的 ERC-721 代币为主</td>
</tr>
</tbody></table>
<h3 id="代币基金"><a href="#代币基金" class="headerlink" title="代币基金"></a>代币基金</h3><p>身负经济体系的重任，统一管理收到的原生币、稳定币：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs solidity">contract TokenFunds &#123;<br>  uint256 private _fundBalance;<br>  uint256 private _totalReceived;<br><br>  string private _paymentToken;<br>  string private _nativeToken;<br>  string[] private _tokenSymbols = [&quot;USDT&quot;];<br><br>  constructor(string nativeToken, string paymentToken) &#123;<br>    _nativeToken = nativeToken;<br>    _setPaymentToken(paymentToken);<br>  &#125;<br><br>  function _isNativeToken(string tokenSymbol) private view return (bool) &#123;<br>    return tokenSymbol == _nativeToken;<br>  &#125;<br><br>  function _isTokenValid(string tokenSymbol) private view return (bool) &#123;<br>    bool valid = _isNativeToken(tokenSymbol);<br><br>    if (valid == false) &#123;<br>      // 遍历 `_tokenSymbols` 检查 `tokenSymbol`<br>    &#125;<br><br>    return valid;<br>  &#125;<br><br>  function _setPaymentToken(string tokenSymbol) private &#123;<br>    require(_isTokenValid(tokenSymbol), &quot;Specific token isn&#x27;t supported.&quot;);<br>    _paymentToken = tokenSymbol;<br>  &#125;<br><br>  function getPaymentToken() external view returns (string) &#123;<br>    return _paymentToken;<br>  &#125;<br><br>  function updatePaymentToken(string newTokenSymbol) external &#123;<br>    _setPaymentToken(paymentToken);<br>  &#125;<br><br>  function _withdrawNativeToken(address payable receiver, uint256 amount) private &#123;<br>    // 提取原生币<br>  &#125;<br><br>  function withdraw(address receiver, uint256 amount) external &#123;<br>    // 判断当前流通代币是否为原生币，<br>    // 是的话就调用 `_withdrawNativeToken()`，<br>    // 否则调用 ERC-20 的 `transfer()`<br>  &#125;<br><br>  function deposit(uint256 amount) external &#123;<br>    // 判断当前流通代币是否为非原生币<br>  &#125;<br><br>  function deposit() external &#123;<br>    // 判断当前流通代币是否为原生币<br>  &#125;<br><br>  function getBalance() external view returns (uint256) &#123;<br>    return _fundBalance;<br>  &#125;<br><br>  function getReceived() external view returns (uint256) &#123;<br>    return _totalReceived;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="系统设置"><a href="#系统设置" class="headerlink" title="系统设置"></a>系统设置</h3><p>设置影响系统正常运行的关键信息：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs solidity">contract SystemSettings &#123;<br>  struct ModuleParam &#123;<br>    string key;<br>    address contractAddr;<br>  &#125;<br><br>  struct ModuleStorage &#123;<br>    address contractAddr;<br>    address admin;<br>  &#125;<br><br>  struct SystemModule &#123;<br>    string key;<br>    address contractAddr;<br>  &#125;<br><br>  mapping(string key =&gt; ModuleStorage) private _moduleMap;<br>  string[] private _moduleKeys;<br><br>  function constructor(address tokenFunds, ModuleParam[] memory modules) &#123;<br>    // 将 `tokenFunds` 和 `modules` 存储到 `_moduleMap` 与 `_moduleKeys` 中<br>  &#125;<br><br>  function getPaymentToken() external view returns (string) &#123;<br>    // 调用基金合约获取流通代币<br>  &#125;<br><br>  function updatePaymentToken(string newTokenSymbol) external &#123;<br>    // 调用基金合约更新流通代币<br>  &#125;<br><br>  function getModules() external view returns (SystemModule[] memory) &#123;<br>    // 根据 `_moduleKeys` 与 `_moduleMap` 拼装模块数组<br>  &#125;<br><br>  function updateAdminForModules(address admin) external &#123;<br>    // 统一设置各个合约的管理员<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="人物关系"><a href="#人物关系" class="headerlink" title="人物关系"></a>人物关系</h3><p>记录有过交易的访客，方便以「人」的维度处理信息：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs solidity">contract People &#123;<br>  uint256 private _totalPeople;<br><br>  struct Person &#123;<br>    address walletAddr;<br>  &#125;<br><br>  mapping(uint256 id =&gt; Person) private _personMap;<br>  mapping(address walletAddr =&gt; uint256) private _idMap;<br><br>  function add(address walletAddr) external &#123;<br>    require(_idMap[walletAddr] == 0, &quot;Wallet address has been added.&quot;);<br><br>    uint256 id = _totalPeople + 1;<br><br>    _personMap[id] = Person(walletAddr);<br>    _idMap[walletAddr] = id;<br><br>    _totalPeople = id;<br>  &#125;<br><br>  function update(uint256 id, address walletAddr) external &#123;<br>    address oldAddr = msg.sender;<br><br>    require(_personMap[id].walletAddr == oldAddr, &quot;Current operator doesn&#x27;t exists.&quot;);<br><br>    _personMap[id].walletAddr = oldAddr;<br>    _idMap[walletAddr] = id;<br>    delete _idMap[oldAddr];<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

</div>
      <footer class="Article-footer col-md-3">
  
  <div class="Widget Widget--share">
    <div class="Widget-body">
      <p>分享到<i class="fa fa-share-alt"></i></p>
      <div class="social-share" data-sites="wechat,weibo,twitter"></div>
    </div>
  </div>


  <section class="Widget Widget--toc">
  <div class="Widget-header">
    <h2 class="Widget-title">目录</h2>
  </div>
  <div class="Widget-body"></div>
</section>


</footer>
      
      
    </article>
    

  </div>
</main>
<footer class="Page-footer Footer">
  <div class="container">
    
    <div class="Footer-description">
      
        <!-- Important links -->
        <nav class="Footer-navs">
          <ul><li><a href="https://meta.ourai.ws/?utm_source=https://s.ourai.ws&amp;utm_medium=common-footer" target="_blank" rel="external nofollow"><span>@</span></a>
</li><li><a href="https://ourai.ws/sponsor/?utm_source=https://s.ourai.ws&amp;utm_medium=common-footer" target="_blank" rel="external nofollow"><span>赞助</span></a>
</li><li><a href="https://yaol.in/cooperation/?utm_source=https://s.ourai.ws&amp;utm_medium=common-footer" target="_blank" rel="external nofollow"><span>合作</span></a>
</li></ul>
        </nav>
      
      
        <!-- Copyright -->
        <div class="Footer-copyright">
          <p>

&copy; 2022-2024 <a href="https://ourai.ws/?utm_source=https://s.ourai.ws&amp;utm_medium=common-footer" target="_blank" rel="external nofollow">欧雷流</a> 版权所有

</p>
          <p>本站主题 <a href="https://ourai.github.io/lime/?utm_source=https://s.ourai.ws&amp;utm_medium=common-footer" target="_blank" rel="external nofollow">Lime</a> 由 <a href="https://linxoid.com/ourai/?utm_source=https://s.ourai.ws&amp;utm_medium=common-footer" target="_blank" rel="external nofollow">欧雷</a> 提供</p>
          
        </div>
      
    </div>
  </div>
</footer>





    <script>$('.Article-content > table').addClass('table table-bordered')</script>
    
<script src="/javascripts/ksio/vendors/share.min.js"></script>

<script src="/javascripts/ksio/components/page.js"></script>

<script src="/javascripts/ksio/components/toc.js"></script>

  </body>
</html>

